<h2 class="mb-4 fw-bold text-primary">
  <i class="bi bi-box-seam"></i> Product Management
</h2>

<div class="d-flex justify-content-between align-items-center mb-3 flex-wrap">
  <a href="/products/add" class="btn btn-success shadow-sm">
    <i class="bi bi-plus-circle"></i> Add Product
  </a>
  <div class="input-group w-auto">
    <input type="text" id="searchInput" class="form-control" placeholder="Search by name..." oninput="filterProducts()">
    <button class="btn btn-outline-secondary" onclick="filterProducts()"><i class="bi bi-search"></i></button>
  </div>
</div>

<div class="table-responsive rounded shadow-sm">
  <table class="table table-hover align-middle bg-white" id="productsTable">
    <thead class="table-primary">
      <tr>
        <th>Name</th>
        <th>Price</th>
        <th>Category</th>
        <th>Subcategory</th>
        <th>Image</th>
        <th style="min-width:120px;">Actions</th>
      </tr>
    </thead>
    <tbody>
      {{#if products.length}}
        {{#each products}}
        <tr>
          <td>{{this.name}}</td>
          <td>â‚¹{{this.price}}</td>
          <td>{{#if this.category}}{{this.category.name}}{{else}}-{{/if}}</td>
          <td>{{#if this.subCategory}}{{this.subCategory.name}}{{else}}-{{/if}}</td>
          <td>
            {{#if this.imageUrl}}
              <img src="{{this.imageUrl}}" alt="{{this.name}}" style="width:48px; height:48px; object-fit:cover; border-radius:6px;">
            {{else}}
              <span class="text-muted">No image</span>
            {{/if}}
          </td>
          <td>
            <a href="/products/{{this.id}}/edit" class="btn btn-sm btn-primary me-1">
              <i class="bi bi-pencil"></i> Edit
            </a>
            <form action="/products/{{this.id}}/delete" method="POST" style="display:inline;">
              <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Delete this product?')">
                <i class="bi bi-trash"></i> Delete
              </button>
            </form>
          </td>
        </tr>
        {{/each}}
      {{else}}
        <tr>
          <td colspan="6" class="text-center text-muted">No products found.</td>
        </tr>
      {{/if}}
    </tbody>
  </table>
</div>

<!-- Modal for Add/Edit Product (optional, for AJAX or future use) -->
<div class="modal fade" id="productModal" tabindex="-1" aria-labelledby="productModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <form id="productForm" class="modal-content" action="/products/add" method="POST">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="productModalLabel">Add Product</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="productId" name="id">
        <div class="mb-3">
          <label for="productName" class="form-label">Name</label>
          <input name="name" id="productName" class="form-control" required>
        </div>
        <div class="mb-3">
          <label for="productPrice" class="form-label">Price</label>
          <input name="price" id="productPrice" type="number" class="form-control" required min="0" step="0.01">
        </div>
        <div class="mb-3">
          <label for="productImage" class="form-label">Image URL</label>
          <input name="imageUrl" id="productImage" class="form-control">
        </div>
        <div class="mb-3">
          <label for="productCategory" class="form-label">Category</label>
          <select name="categoryId" id="productCategory" class="form-select" required>
            <option value="">Select Category</option>
            {{#each categories}}
              <option value="{{this.id}}">{{this.name}}</option>
            {{/each}}
          </select>
        </div>
        <div class="mb-3">
          <label for="productSubcategory" class="form-label">Subcategory</label>
          <select name="subCategoryId" id="productSubcategory" class="form-select" required>
            <option value="">Select Subcategory</option>
            {{#each subcategories}}
              <option value="{{this.id}}">{{this.name}}</option>
            {{/each}}
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-primary shadow-sm">Save</button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
      </div>
    </form>
  </div>
</div>

<!-- Bootstrap 5 JS and Bootstrap Icons CDN -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
function filterProducts() {
  const search = document.getElementById('searchInput').value.toLowerCase();
  const rows = document.querySelectorAll('#productsTable tbody tr');
  let anyVisible = false;
  rows.forEach(row => {
    const name = row.children[0].textContent.toLowerCase();
    if (name.includes(search)) {
      row.style.display = '';
      anyVisible = true;
    } else {
      row.style.display = 'none';
    }
  });
  // Hide "No products found" row if any are visible
  const noProductsRow = document.querySelector('#productsTable tbody tr td[colspan="6"]');
  if (noProductsRow) {
    noProductsRow.parentElement.style.display = anyVisible ? 'none' : '';
  }
}
</script>

<style>
body {
  background: #f6f7fb;
}
.table thead th {
  vertical-align: middle;
}
.table td, .table th {
  vertical-align: middle;
}
#productsTable img {
  width: 48px;
  height: 48px;
  object-fit: cover;
  border-radius: 6px;
  border: 1px solid #eee;
}
.btn {
  transition: box-shadow 0.2s;
}
.btn:active, .btn:focus {
  box-shadow: 0 0 0 0.2rem #007bff33;
}
input[type="text"]:focus, input[type="number"]:focus, select:focus {
  border-color: #007bff;
  box-shadow: 0 0 0 0.15rem #007bff33;
}
.modal-header {
  border-bottom: 1px solid #e5e5e5;
}
.modal-footer {
  border-top: 1px solid #e5e5e5;
}
</style>
