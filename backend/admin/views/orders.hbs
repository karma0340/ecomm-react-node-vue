<h2 class="mb-4 fw-bold text-primary">
  <i class="bi bi-receipt"></i> Orders
</h2>

<div class="mb-3 d-flex flex-wrap justify-content-between align-items-center">
  <div>
    <input type="text" id="orderSearch" class="form-control" placeholder="Search by user, status, or payment..." style="min-width:260px;" oninput="filterOrders()">
  </div>
  <div class="text-muted small">
    Total Orders: <span id="ordersCount">{{orders.length}}</span>
  </div>
</div>

<div class="card shadow-sm">
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0" id="ordersTable">
        <thead class="table-primary">
          <tr>
            <th>#</th>
            <th>User</th>
            <th>Total</th>
            <th>Status</th>
            <th>Payment</th>
            <th>Date</th>
            <th style="min-width:120px;">Actions</th>
          </tr>
        </thead>
        <tbody>
          {{#if orders.length}}
            {{#each orders}}
            <tr>
              <td>{{this.id}}</td>
              <td>
                {{#if this.user}}
                  <span class="fw-semibold">{{this.user.name}}</span><br>
                  <small class="text-muted d-block">@{{this.user.username}}</small>
                  <small class="text-muted">{{this.user.email}}</small>
                {{else}}
                  <span class="text-muted">Guest</span>
                {{/if}}
              </td>
              <td>â‚¹{{this.total}}</td>
              <td>
                {{#if (eq this.status "Completed")}}
                  <span class="badge bg-success">Completed</span>
                {{else if (eq this.status "Pending")}}
                  <span class="badge bg-warning text-dark">Pending</span>
                {{else if (eq this.status "Cancelled")}}
                  <span class="badge bg-danger">Cancelled</span>
                {{else}}
                  <span class="badge bg-secondary">{{this.status}}</span>
                {{/if}}
              </td>
              <td>
                {{#if (eq this.paymentMethod "COD")}}
                  <span class="badge bg-info text-dark">COD</span>
                {{else if (eq this.paymentMethod "Card")}}
                  <span class="badge bg-primary">Card</span>
                {{else}}
                  <span class="badge bg-secondary">{{this.paymentMethod}}</span>
                {{/if}}
              </td>
              <td>
                {{formatDate this.createdAt}}
              </td>
              <td>
                <a href="/orders/{{this.id}}" class="btn btn-sm btn-outline-primary me-1">
                  <i class="bi bi-eye"></i> View
                </a>
                <form action="/orders/{{this.id}}/delete" method="POST" style="display:inline;">
                  <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Delete this order?')">
                    <i class="bi bi-trash"></i>
                  </button>
                </form>
              </td>
            </tr>
            {{/each}}
          {{else}}
            <tr>
              <td colspan="7" class="text-center text-muted">No orders found.</td>
            </tr>
          {{/if}}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Bootstrap 5 Icons (if not already included in your layout) -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">

<script>
function filterOrders() {
  const input = document.getElementById('orderSearch').value.toLowerCase();
  const rows = document.querySelectorAll('#ordersTable tbody tr');
  let visible = 0;
  rows.forEach(row => {
    // Search in user name, email, status, payment, and order id
    const text = row.textContent.toLowerCase();
    if (text.includes(input)) {
      row.style.display = '';
      visible++;
    } else {
      row.style.display = 'none';
    }
  });
  document.getElementById('ordersCount').textContent = visible;
}
</script>

<style>
body {
  background: #f6f7fb;
}
.card {
  margin-top: 32px;
  border-radius: 12px;
}
.table th, .table td {
  vertical-align: middle;
}
.badge {
  font-size: 0.95em;
  letter-spacing: .03em;
}
#orderSearch:focus {
  box-shadow: 0 0 0 0.15rem #0d6efd33;
  border-color: #0d6efd;
}
</style>
