import{r as s,c as o,o as n,a as e,b as h,z as S,d as j,w as r,v as x,D,F as T,q as V,t as u,e as K}from"./runtime-dom.esm-bundler-BMOpcSRA.js";const Q={class:"container py-4"},W={class:"card shadow-sm border-0 mb-4"},X={class:"card-body"},Y={class:"col-md-3"},Z={class:"col-md-3"},ee=["value"],le={class:"col-md-3"},te={class:"col-md-3"},ae={class:"form-label"},se={class:"col-12"},oe=["disabled"],ne={class:"card shadow-sm border-0 mb-3"},ie={class:"card-body p-0"},de={class:"table table-hover align-middle mb-0 text-center"},ue={class:"badge bg-primary"},re=["src"],ce={class:"d-flex justify-content-center gap-2"},me=["onClick"],ve=["onClick","disabled"],ge={key:0},be={key:0,class:"modal-backdrop fade show"},pe={key:1,class:"modal fade show d-block",tabindex:"-1"},fe={class:"modal-dialog modal-lg modal-dialog-centered"},ye={class:"modal-content"},we={class:"modal-body"},Ie={class:"col-md-4"},he={class:"col-md-4"},Ue=["value"],_e={class:"col-md-4"},Ce={key:0,class:"col-md-6"},ke={key:1,class:"col-md-6"},Se={class:"col-md-6"},xe=["src"],De={class:"col-12 d-flex justify-content-end"},Ee=["disabled"],Fe={__name:"SubcategoryManager",props:{initialSubcategories:Array,initialCategories:Array},setup(P){const L=P,c=s([...L.initialSubcategories]),p=s([...L.initialCategories]),f=s(""),y=s(""),m=s("file"),w=s(""),U=s(null),M=s(null),_=s(!1),E=s(null),C=s(!1),i=s({}),I=s(null),v=s("file"),g=s(""),b=s(null),k=s(!1),$=a=>new Date(a).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),q=a=>{const l=p.value.find(t=>t.id===a);return l?l.name:"(Unknown)"};function B(a){U.value=a.target?.files?.[0]||null}function O(a){const l=a.target?.files?.[0];if(I.value=l,l){const t=new FileReader;t.onload=d=>b.value=d.target.result,t.readAsDataURL(l)}else b.value=null}async function G(){if(!f.value.trim()||!y.value){alert("Please fill in all fields.");return}_.value=!0;const a=new FormData;a.append("name",f.value.trim()),a.append("categoryId",y.value),m.value==="file"&&U.value?a.append("image",U.value):m.value==="url"&&w.value&&a.append("imageUrl",w.value.trim());try{const t=await(await fetch("/api/subcategories",{method:"POST",body:a})).json(),d=p.value.find(A=>A.id===t.categoryId);c.value.unshift({...t,Category:d}),f.value="",y.value="",w.value="",U.value=null,M.value&&(M.value.value=null)}catch{alert("Failed to add subcategory")}finally{_.value=!1}}async function z(a){if(confirm("Are you sure you want to delete this subcategory?")){E.value=a;try{if(!(await fetch(`/api/subcategories/${a}`,{method:"DELETE"})).ok)throw new Error;c.value=c.value.filter(t=>t.id!==a)}catch{alert("Failed to delete subcategory")}finally{E.value=null}}}function H(a){i.value={...a},I.value=null,g.value="",v.value="file",b.value=null,C.value=!0}function F(){C.value=!1,i.value={},I.value=null,g.value="",b.value=null}async function J(){if(!i.value.name||!i.value.categoryId)return;k.value=!0;const a=i.value.id,l=new FormData;l.append("name",i.value.name),l.append("categoryId",i.value.categoryId),v.value==="file"&&I.value?l.append("image",I.value):v.value==="url"&&g.value&&l.append("imageUrl",g.value.trim());try{const d=await(await fetch(`/api/subcategories/${a}`,{method:"PUT",body:l})).json(),A=p.value.find(N=>N.id===d.categoryId),R=c.value.findIndex(N=>N.id===a);R>=0&&(d.imageUrl=`${d.imageUrl}?t=${Date.now()}`,c.value[R]={...d,Category:A}),F()}catch{alert("Failed to update subcategory")}finally{k.value=!1}}return(a,l)=>(n(),o("div",Q,[l[27]||(l[27]=e("h2",{class:"mb-4 text-info"},[e("i",{class:"bi bi-diagram-3"}),S(" Manage Subcategories ")],-1)),e("div",W,[e("div",X,[e("form",{class:"row g-3 align-items-end",onSubmit:j(G,["prevent"])},[e("div",Y,[l[8]||(l[8]=e("label",{class:"form-label"},"Name",-1)),r(e("input",{"onUpdate:modelValue":l[0]||(l[0]=t=>f.value=t),type:"text",class:"form-control",placeholder:"Subcategory name",required:""},null,512),[[x,f.value]])]),e("div",Z,[l[10]||(l[10]=e("label",{class:"form-label"},"Category",-1)),r(e("select",{"onUpdate:modelValue":l[1]||(l[1]=t=>y.value=t),class:"form-select",required:""},[l[9]||(l[9]=e("option",{value:"",disabled:""},"Select category",-1)),(n(!0),o(T,null,V(p.value,t=>(n(),o("option",{key:t.id,value:t.id},u(t.name),9,ee))),128))],512),[[D,y.value]])]),e("div",le,[l[12]||(l[12]=e("label",{class:"form-label"},"Image Source",-1)),r(e("select",{"onUpdate:modelValue":l[2]||(l[2]=t=>m.value=t),class:"form-select"},l[11]||(l[11]=[e("option",{value:"file"},"Upload File",-1),e("option",{value:"url"},"Paste Image URL",-1)]),512),[[D,m.value]])]),e("div",te,[e("label",ae,u(m.value==="file"?"Upload Image":"Image URL"),1),m.value==="file"?(n(),o("input",{key:0,type:"file",class:"form-control",accept:"image/*",onChange:B},null,32)):r((n(),o("input",{key:1,type:"url","onUpdate:modelValue":l[3]||(l[3]=t=>w.value=t),class:"form-control",placeholder:"https://example.com/image.png"},null,512)),[[x,w.value]])]),e("div",se,[e("button",{class:"btn btn-success",disabled:_.value},[l[13]||(l[13]=e("i",{class:"bi bi-plus-circle me-1"},null,-1)),S(" "+u(_.value?"Adding...":"Add Subcategory"),1)],8,oe)])],32)])]),e("div",ne,[e("div",ie,[e("table",de,[l[17]||(l[17]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"ID"),e("th",null,"Name"),e("th",null,"Category"),e("th",null,"ImageðŸ“·"),e("th",null,"Created"),e("th",null,"Actions")])],-1)),e("tbody",null,[(n(!0),o(T,null,V(c.value,t=>(n(),o("tr",{key:t.id},[e("td",null,u(t.id),1),e("td",null,u(t.name),1),e("td",null,[e("span",ue,u(t.Category?.name||q(t.categoryId)),1)]),e("td",null,[t.imageUrl?(n(),o("img",{key:0,src:t.imageUrl,alt:"subcategory",class:"rounded shadow-sm",style:{width:"45px",height:"45px","object-fit":"cover"}},null,8,re)):h("",!0)]),e("td",null,u($(t.createdAt)),1),e("td",ce,[e("button",{onClick:d=>H(t),class:"btn btn-outline-secondary btn-sm"},l[14]||(l[14]=[e("i",{class:"bi bi-pencil"},null,-1)]),8,me),e("button",{onClick:d=>z(t.id),class:"btn btn-outline-danger btn-sm",disabled:E.value===t.id},l[15]||(l[15]=[e("i",{class:"bi bi-trash"},null,-1)]),8,ve)])]))),128)),c.value.length?h("",!0):(n(),o("tr",ge,l[16]||(l[16]=[e("td",{colspan:"6",class:"text-center py-4 text-muted"},[e("i",{class:"bi bi-inbox fs-3"}),e("br"),S("No subcategories available ")],-1)])))])])])]),C.value?(n(),o("div",be)):h("",!0),C.value?(n(),o("div",pe,[e("div",fe,[e("div",ye,[e("div",{class:"modal-header bg-secondary text-white"},[l[18]||(l[18]=e("h5",{class:"modal-title"},[e("i",{class:"bi bi-pencil"}),S(" Edit Subcategory")],-1)),e("button",{class:"btn-close btn-close-white",onClick:F})]),e("div",we,[e("form",{class:"row g-3 align-items-end",onSubmit:j(J,["prevent"])},[e("div",Ie,[l[19]||(l[19]=e("label",{class:"form-label"},"Name",-1)),r(e("input",{"onUpdate:modelValue":l[4]||(l[4]=t=>i.value.name=t),type:"text",class:"form-control",required:""},null,512),[[x,i.value.name]])]),e("div",he,[l[20]||(l[20]=e("label",{class:"form-label"},"Category",-1)),r(e("select",{"onUpdate:modelValue":l[5]||(l[5]=t=>i.value.categoryId=t),class:"form-select",required:""},[(n(!0),o(T,null,V(p.value,t=>(n(),o("option",{key:t.id,value:t.id},u(t.name),9,Ue))),128))],512),[[D,i.value.categoryId]])]),e("div",_e,[l[22]||(l[22]=e("label",{class:"form-label"},"Image Source",-1)),r(e("select",{"onUpdate:modelValue":l[6]||(l[6]=t=>v.value=t),class:"form-select"},l[21]||(l[21]=[e("option",{value:"file"},"Upload File",-1),e("option",{value:"url"},"Paste ImageðŸ“· URL",-1)]),512),[[D,v.value]])]),v.value==="file"?(n(),o("div",Ce,[l[23]||(l[23]=e("label",{class:"form-label"},"Upload Image",-1)),e("input",{type:"file",class:"form-control",onChange:O,accept:"image/*"},null,32)])):(n(),o("div",ke,[l[24]||(l[24]=e("label",{class:"form-label"},"Image URL",-1)),r(e("input",{"onUpdate:modelValue":l[7]||(l[7]=t=>g.value=t),type:"url",class:"form-control",placeholder:"https://example.com/image.jpg"},null,512),[[x,g.value]])])),e("div",Se,[l[25]||(l[25]=e("label",{class:"form-label"},"Preview",-1)),l[26]||(l[26]=e("br",null,null,-1)),i.value.imageUrl||b.value?(n(),o("img",{key:0,src:b.value||i.value.imageUrl,class:"rounded shadow-sm",style:{width:"80px",height:"80px","object-fit":"cover"}},null,8,xe)):h("",!0)]),e("div",De,[e("button",{class:"btn btn-secondary me-2",onClick:F},"Cancel"),e("button",{class:"btn btn-success",type:"submit",disabled:k.value},u(k.value?"Updating...":"Update"),9,Ee)])],32)])])])])):h("",!0)]))}},Ae=window.__INITIAL_SUBCATEGORIES__||[],Ne=window.__INITIAL_CATEGORIES__||[];K(Fe,{initialSubcategories:Ae,initialCategories:Ne}).mount("#vue-subcategories-app");
