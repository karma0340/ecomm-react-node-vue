import{r as v,D as T,i as z,c as d,o as i,a as l,b,C as f,d as j,w as c,v as g,E as P,F as y,p as _,t as r,B as I,e as Z}from"./runtime-dom.esm-bundler-CKHVjIEV.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";const J={class:"container py-4"},K={key:0,class:"card shadow-sm mb-4 border-0"},Q={class:"card-body"},W={class:"col-md-3"},X=["disabled"],Y={class:"col-md-2"},ee=["disabled"],le={class:"col-md-2"},te=["disabled"],ae={class:"col-md-2"},se=["disabled"],oe=["value"],de={class:"col-md-2"},ie=["disabled"],ne=["value"],ue={class:"col-md-3"},re=["disabled"],ce={class:"col-md-3"},ve=["disabled"],me={class:"col-md-2 d-flex align-items-end"},be=["disabled"],pe={key:1,class:"text-center py-5"},ge={key:2,class:"alert alert-danger text-center my-4"},fe={key:3,class:"card shadow-sm border-0"},ye={class:"card-body p-0"},_e={class:"table-responsive"},we={class:"table table-hover table-bordered align-middle text-center mb-0 products-table"},he=["title"],ke=["src"],Ie=["onClick"],xe=["onClick","disabled"],Ce={key:0},Ue={class:"d-flex justify-content-between align-items-center px-3 pb-3 pt-2"},Pe={class:"text-muted small"},Se={class:"pagination pagination-sm mb-0"},Ae=["disabled"],Ee=["disabled"],Ve=["onClick"],De=["disabled"],Ne=["disabled"],Te={key:4,class:"modal-backdrop fade show"},qe={key:5,class:"modal fade show d-block",tabindex:"-1"},je={class:"modal-dialog modal-lg modal-dialog-centered"},Fe={class:"modal-content"},$e={class:"modal-header bg-primary text-white"},Le={class:"modal-title"},Me={class:"modal-body"},Re={class:"row g-3"},Be={class:"col-md-6"},Oe=["disabled"],Ge={class:"col-md-3"},ze=["disabled"],Ze={class:"col-md-3"},He=["disabled"],Je={class:"col-md-6"},Ke=["disabled"],Qe=["value"],We={class:"col-md-6"},Xe=["disabled"],Ye=["value"],el={class:"col-md-6"},ll=["disabled"],tl={class:"col-md-6"},al=["disabled"],sl={key:0,class:"col-md-4"},ol=["src"],dl={class:"col-12 d-flex justify-content-end mt-3"},il=["disabled"],nl=["disabled"],S="/products/api",A=10,ul="https://cdn-icons-png.flaticon.com/512/2331/2331949.png",rl={__name:"ProductsTable",setup(pl){const w=v(!1),x=v(""),m=v([]),E=v([]),V=v([]),C=v([]),n=v(1),p=T(()=>Math.max(1,Math.ceil(m.value.length/A))),q=T(()=>m.value.slice((n.value-1)*A,n.value*A)),F=T(()=>{const s=p.value,e=5;if(s<=e)return Array.from({length:s},(U,k)=>k+1);let t=Math.max(1,n.value-2),u=Math.min(s,t+e-1);return u-t<e-1&&(t=Math.max(1,u-e+1)),Array.from({length:u-t+1},(U,k)=>t+k)});function h(s){s>=1&&s<=p.value&&(n.value=s)}const o=v({name:"",price:"",stock:0,categoryId:"",subCategoryId:"",file:null,imageUrl:"",loading:!1}),D=v(null),a=v({show:!1,data:{},file:null,urlInput:"",preview:null,loading:!1}),$=s=>s?new Date(s).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"}):"-";z(L);async function L(){w.value=!0,x.value="";try{const[s,e,t]=await Promise.all([fetch(S).then(u=>u.json()),fetch("/api/categories").then(u=>u.json()),fetch("/api/subcategories").then(u=>u.json())]);m.value=Array.isArray(s)?s:s.products??[],E.value=Array.isArray(e)?e:e.categories??[],V.value=Array.isArray(t)?t:t.subcategories??[],n.value=1}catch(s){x.value=s.message||"Failed to load products data"}w.value=!1}async function M(){if(!o.value.name||o.value.price===""||o.value.stock===""||!o.value.categoryId){alert("Name/Price/Stock/Category required");return}o.value.loading=!0;const s=new FormData;s.append("name",o.value.name),s.append("price",o.value.price),s.append("stock",o.value.stock),s.append("categoryId",o.value.categoryId),s.append("subCategoryId",o.value.subCategoryId),o.value.file?s.append("image",o.value.file):o.value.imageUrl&&s.append("imageUrl",o.value.imageUrl);try{const e=await fetch(S,{method:"POST",body:s});if(!e.ok)throw new Error(await e.text());const t=await e.json();m.value.unshift(t),Object.assign(o.value,{name:"",price:"",stock:0,categoryId:"",subCategoryId:"",file:null,imageUrl:"",loading:!1}),D.value&&(D.value.value=null),n.value=1}catch(e){alert(e.message||"Error creating product"),o.value.loading=!1}}async function R(s){if(confirm("Are you sure?")){C.value.push(s);try{if(!(await fetch(`${S}/${s}`,{method:"DELETE"})).ok)throw new Error("Failed to delete");m.value=m.value.filter(t=>t.id!==s),(n.value-1)*A>=m.value.length&&n.value>1&&(n.value-=1)}catch(e){alert(e.message)}C.value=C.value.filter(e=>e!==s)}}function B(s){a.value.show=!0,a.value.data={...s,price:Number(s.price),stock:Number(s.stock),categoryId:s.categoryId||"",subCategoryId:s.subCategoryId||""},a.value.file=null,a.value.urlInput="",a.value.preview=null}function N(){a.value.show=!1,a.value.data={},a.value.file=null,a.value.urlInput="",a.value.preview=null}function O(s){const e=s.target.files?.[0]||null;if(a.value.file=e,e){const t=new FileReader;t.onload=u=>a.value.preview=u.target.result,t.readAsDataURL(e)}else a.value.preview=null}async function G(){a.value.loading=!0;const s=a.value.data.id,e=new FormData;e.append("name",a.value.data.name),e.append("price",a.value.data.price),e.append("stock",a.value.data.stock),e.append("categoryId",a.value.data.categoryId),e.append("subCategoryId",a.value.data.subCategoryId),a.value.file?e.append("image",a.value.file):a.value.urlInput&&e.append("imageUrl",a.value.urlInput);try{const t=await fetch(`${S}/${s}`,{method:"PUT",body:e});if(!t.ok)throw new Error(await t.text());const u=await t.json(),U=m.value.findIndex(k=>k.id===s);U!==-1&&(m.value[U]=u),N()}catch(t){alert(t.message||"Error updating product")}a.value.loading=!1}return(s,e)=>(i(),d("div",J,[e[45]||(e[45]=l("div",{class:"d-flex justify-content-between align-items-center mb-4"},[l("h2",{class:"mb-0 text-primary"},[l("i",{class:"bi bi-box-seam me-2"}),f(" Manage Products ")])],-1)),w.value?b("",!0):(i(),d("div",K,[l("div",Q,[l("form",{class:"row g-3 align-items-center",onSubmit:j(M,["prevent"])},[l("div",W,[e[18]||(e[18]=l("label",{class:"form-label fw-semibold"},"Product Name",-1)),c(l("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>o.value.name=t),type:"text",class:"form-control",required:"",disabled:o.value.loading},null,8,X),[[g,o.value.name]])]),l("div",Y,[e[19]||(e[19]=l("label",{class:"form-label fw-semibold"},"Price",-1)),c(l("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>o.value.price=t),type:"number",class:"form-control",required:"",min:"0",step:"0.01",disabled:o.value.loading},null,8,ee),[[g,o.value.price,void 0,{number:!0}]])]),l("div",le,[e[20]||(e[20]=l("label",{class:"form-label fw-semibold"},"Stock",-1)),c(l("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>o.value.stock=t),type:"number",class:"form-control",required:"",min:"0",disabled:o.value.loading},null,8,te),[[g,o.value.stock,void 0,{number:!0}]])]),l("div",ae,[e[22]||(e[22]=l("label",{class:"form-label fw-semibold"},"Category",-1)),c(l("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>o.value.categoryId=t),class:"form-select",required:"",disabled:o.value.loading},[e[21]||(e[21]=l("option",{value:""},"Select",-1)),(i(!0),d(y,null,_(E.value,t=>(i(),d("option",{key:t.id,value:t.id},r(t.name),9,oe))),128))],8,se),[[P,o.value.categoryId]])]),l("div",de,[e[24]||(e[24]=l("label",{class:"form-label fw-semibold"},"Subcategory",-1)),c(l("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>o.value.subCategoryId=t),class:"form-select",required:"",disabled:o.value.loading},[e[23]||(e[23]=l("option",{value:""},"Select",-1)),(i(!0),d(y,null,_(V.value,t=>(i(),d("option",{key:t.id,value:t.id},r(t.name),9,ne))),128))],8,ie),[[P,o.value.subCategoryId]])]),l("div",ue,[e[25]||(e[25]=l("label",{class:"form-label fw-semibold"},"Image",-1)),l("input",{ref_key:"addFileInput",ref:D,type:"file",class:"form-control",accept:"image/*",onChange:e[5]||(e[5]=t=>o.value.file=t.target.files?.[0]||null),disabled:o.value.loading},null,40,re)]),l("div",ce,[e[26]||(e[26]=l("label",{class:"form-label fw-semibold"},"Image URL",-1)),c(l("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>o.value.imageUrl=t),type:"url",class:"form-control",placeholder:"https://example.com/image.jpg",disabled:o.value.loading},null,8,ve),[[g,o.value.imageUrl]])]),l("div",me,[l("button",{class:"btn btn-success w-100",disabled:o.value.loading},[e[27]||(e[27]=l("i",{class:"bi bi-plus-circle me-2"},null,-1)),f(" "+r(o.value.loading?"Saving...":"Add"),1)],8,be)])],32)])])),w.value?(i(),d("div",pe,e[28]||(e[28]=[l("span",{class:"spinner-border text-primary"},null,-1)]))):b("",!0),x.value?(i(),d("div",ge,r(x.value),1)):b("",!0),w.value?b("",!0):(i(),d("div",fe,[l("div",ye,[l("div",_e,[l("table",we,[e[32]||(e[32]=l("thead",{class:"table-light"},[l("tr",null,[l("th",{style:{width:"56px"}},"#"),l("th",{style:{"min-width":"180px"}},"Name"),l("th",{style:{width:"100px"}},"Price"),l("th",{style:{width:"90px"}},"Stock"),l("th",{style:{width:"120px"}},"Category"),l("th",{style:{width:"140px"}},"Subcategory"),l("th",{style:{width:"80px"}},"ImageðŸ“·"),l("th",{style:{width:"120px"}},"Created"),l("th",{style:{width:"120px"}},"Actions")])],-1)),l("tbody",null,[(i(!0),d(y,null,_(q.value,t=>(i(),d("tr",{key:t.id},[l("td",null,r(t.id),1),l("td",{class:"fw-semibold text-start prod-name-col",title:t.name},r(t.name),9,he),l("td",null,"â‚¹"+r(t.price),1),l("td",null,r(t.stock),1),l("td",null,r(t.category?.name||"-"),1),l("td",null,r(t.subCategory?.name||"-"),1),l("td",null,[t.imageUrl?(i(),d("img",{key:0,src:t.imageUrl,class:"img-thumbnail prod-thumb",alt:"Image",onError:e[7]||(e[7]=u=>u.target.src=ul)},null,40,ke)):b("",!0)]),l("td",null,r($(t.createdAt)),1),l("td",null,[l("button",{class:"btn btn-outline-secondary btn-sm me-2",onClick:u=>B(t)},e[29]||(e[29]=[l("i",{class:"bi bi-pencil"},null,-1),f(" Edit ")]),8,Ie),l("button",{class:"btn btn-outline-danger btn-sm",onClick:u=>R(t.id),disabled:C.value.includes(t.id)},e[30]||(e[30]=[l("i",{class:"bi bi-trash"},null,-1),f(" Delete ")]),8,xe)])]))),128)),q.value.length===0?(i(),d("tr",Ce,e[31]||(e[31]=[l("td",{colspan:"9",class:"text-center text-muted py-4"},[l("i",{class:"bi bi-inbox fs-3"}),l("br"),f(" No products available ")],-1)]))):b("",!0)])])]),l("div",Ue,[l("span",Pe,"Page "+r(n.value)+" of "+r(p.value),1),l("nav",null,[l("ul",Se,[l("li",{class:I(["page-item",{disabled:n.value===1}])},[l("button",{class:"page-link",onClick:e[8]||(e[8]=t=>h(1)),disabled:n.value===1},"First",8,Ae)],2),l("li",{class:I(["page-item",{disabled:n.value===1}])},[l("button",{class:"page-link",onClick:e[9]||(e[9]=t=>h(n.value-1)),disabled:n.value===1},"â€¹",8,Ee)],2),(i(!0),d(y,null,_(F.value,t=>(i(),d("li",{class:I(["page-item",{active:n.value===t}]),key:t},[l("button",{class:"page-link",onClick:u=>h(t)},r(t),9,Ve)],2))),128)),l("li",{class:I(["page-item",{disabled:n.value===p.value}])},[l("button",{class:"page-link",onClick:e[10]||(e[10]=t=>h(n.value+1)),disabled:n.value===p.value},"â€º",8,De)],2),l("li",{class:I(["page-item",{disabled:n.value===p.value}])},[l("button",{class:"page-link",onClick:e[11]||(e[11]=t=>h(p.value)),disabled:n.value===p.value},"Last",8,Ne)],2)])])])])])),a.value.show?(i(),d("div",Te)):b("",!0),a.value.show?(i(),d("div",qe,[l("div",je,[l("div",Fe,[l("div",$e,[l("h5",Le,[e[33]||(e[33]=l("i",{class:"bi bi-pencil-square me-2"},null,-1)),f("Edit Product #"+r(a.value.data.id),1)]),l("button",{type:"button",class:"btn-close btn-close-white",onClick:N})]),l("div",Me,[l("form",{onSubmit:j(G,["prevent"])},[l("div",Re,[l("div",Be,[e[34]||(e[34]=l("label",{class:"form-label"},"Name",-1)),c(l("input",{"onUpdate:modelValue":e[12]||(e[12]=t=>a.value.data.name=t),type:"text",class:"form-control",required:"",disabled:a.value.loading},null,8,Oe),[[g,a.value.data.name]])]),l("div",Ge,[e[35]||(e[35]=l("label",{class:"form-label"},"Price",-1)),c(l("input",{"onUpdate:modelValue":e[13]||(e[13]=t=>a.value.data.price=t),type:"number",class:"form-control",required:"",min:"0",step:"0.01",disabled:a.value.loading},null,8,ze),[[g,a.value.data.price,void 0,{number:!0}]])]),l("div",Ze,[e[36]||(e[36]=l("label",{class:"form-label"},"Stock",-1)),c(l("input",{"onUpdate:modelValue":e[14]||(e[14]=t=>a.value.data.stock=t),type:"number",class:"form-control",required:"",min:"0",disabled:a.value.loading},null,8,He),[[g,a.value.data.stock,void 0,{number:!0}]])]),l("div",Je,[e[38]||(e[38]=l("label",{class:"form-label"},"Category",-1)),c(l("select",{"onUpdate:modelValue":e[15]||(e[15]=t=>a.value.data.categoryId=t),class:"form-select",required:"",disabled:a.value.loading},[e[37]||(e[37]=l("option",{value:""},"Select",-1)),(i(!0),d(y,null,_(E.value,t=>(i(),d("option",{key:t.id,value:t.id},r(t.name),9,Qe))),128))],8,Ke),[[P,a.value.data.categoryId]])]),l("div",We,[e[40]||(e[40]=l("label",{class:"form-label"},"Subcategory",-1)),c(l("select",{"onUpdate:modelValue":e[16]||(e[16]=t=>a.value.data.subCategoryId=t),class:"form-select",required:"",disabled:a.value.loading},[e[39]||(e[39]=l("option",{value:""},"Select",-1)),(i(!0),d(y,null,_(V.value,t=>(i(),d("option",{key:t.id,value:t.id},r(t.name),9,Ye))),128))],8,Xe),[[P,a.value.data.subCategoryId]])]),l("div",el,[e[41]||(e[41]=l("label",{class:"form-label"},"Image",-1)),l("input",{type:"file",class:"form-control",onChange:O,disabled:a.value.loading},null,40,ll)]),l("div",tl,[e[42]||(e[42]=l("label",{class:"form-label"},"Or Image URL",-1)),c(l("input",{"onUpdate:modelValue":e[17]||(e[17]=t=>a.value.urlInput=t),type:"url",class:"form-control",placeholder:"https://example.com/image.jpg",disabled:a.value.loading},null,8,al),[[g,a.value.urlInput]])]),a.value.data.imageUrl||a.value.preview?(i(),d("div",sl,[e[43]||(e[43]=l("label",{class:"form-label"},"Preview",-1)),e[44]||(e[44]=l("br",null,null,-1)),l("img",{src:a.value.preview||a.value.data.imageUrl,class:"prod-thumb",style:{width:"60px",height:"60px"},alt:"Preview"},null,8,ol)])):b("",!0),l("div",dl,[l("button",{class:"btn btn-secondary me-2",type:"button",onClick:N,disabled:a.value.loading},"Cancel",8,il),l("button",{class:"btn btn-primary",disabled:a.value.loading},r(a.value.loading?"Updating...":"Update"),9,nl)])])],32)])])])])):b("",!0)]))}},cl=H(rl,[["__scopeId","data-v-6e3012cd"]]),vl=window.__INITIAL_PRODUCTS__||[],ml=window.__INITIAL_CATEGORIES__||[],bl=window.__INITIAL_SUBCATEGORIES__||[];Z(cl,{products:vl,categories:ml,subcategories:bl}).mount("#vue-products");
