import{r,c as o,o as n,a as e,b as f,d as U,w as c,v as w,E as C,t as d,C as b,F as V,p as j,e as R}from"./runtime-dom.esm-bundler-CKHVjIEV.js";import{_ as S}from"./_plugin-vue_export-helper-DlAUqK2U.js";const M={class:"container py-4"},P={class:"card shadow-sm mb-4 border-0"},$={class:"card-body"},q={class:"col-md-4"},B={class:"col-md-3"},O={class:"col-md-4"},G={class:"form-label fw-semibold"},z={class:"col-md-1 d-flex align-items-end"},H=["disabled"],J={class:"card shadow-sm border-0"},K={class:"card-body p-0"},Q={class:"table table-hover align-middle text-center mb-0"},W={class:"fw-semibold"},X=["src"],Y=["onClick"],Z=["onClick"],ee={key:0},le={key:0,class:"modal-backdrop fade show"},te={key:1,class:"modal fade show d-block",tabindex:"-1"},ae={class:"modal-dialog modal-lg modal-dialog-centered"},se={class:"modal-content"},oe={class:"modal-header bg-primary text-white"},ne={class:"modal-title"},ie={class:"modal-body"},re={class:"row g-3"},de={class:"col-md-4"},ue={class:"col-md-4"},me={class:"col-md-4"},ce={class:"form-label"},pe={key:0,class:"col-md-6"},ve=["src"],fe={class:"col-12 d-flex justify-content-end mt-3"},be=["disabled"],ge={__name:"CategoryManager",props:{initialCategories:{type:Array,default:()=>[]}},setup(k){const u=r([...k.initialCategories]),p=r(""),g=r(null),h=r(null),v=r(""),m=r("file"),y=r(!1),t=r({show:!1,data:{},file:null,preview:null,urlInput:"",inputType:"file",updating:!1}),x=s=>new Date(s).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"}),E=s=>{g.value=s.target?.files?.[0]||null},T=async()=>{if(!p.value.trim()){alert("Please enter a category name");return}y.value=!0;const s=new FormData;s.append("name",p.value.trim()),m.value==="file"&&g.value?s.append("image",g.value):m.value==="url"&&v.value.trim()&&s.append("imageUrl",v.value.trim());try{const l=await fetch("/api/categories",{method:"POST",body:s});if(!l.ok)throw new Error("Failed to create category");const a=await l.json();u.value.unshift(a),g.value=null,v.value="",p.value="",h.value&&(h.value.value=null)}catch(l){alert(l.message||"Error")}finally{y.value=!1}},D=async s=>{if(confirm("Are you sure?"))try{if(!(await fetch(`/api/categories/${s}`,{method:"DELETE"})).ok)throw new Error("Failed to delete");u.value=u.value.filter(a=>a.id!==s)}catch(l){alert(l.message)}},F=s=>{const l=s.target?.files?.[0]||null;if(t.value.file=l,l){const a=new FileReader;a.onload=i=>t.value.preview=i.target.result,a.readAsDataURL(l)}else t.value.preview=null},A=s=>{t.value.show=!0,t.value.data={...s},t.value.file=null,t.value.preview=null,t.value.urlInput="",t.value.inputType="file"},_=()=>{t.value.show=!1,t.value.data={},t.value.file=null,t.value.preview=null,t.value.urlInput=""},L=async()=>{const s=t.value.data.id,l=new FormData;l.append("name",t.value.data.name),t.value.inputType==="file"&&t.value.file?l.append("image",t.value.file):t.value.inputType==="url"&&t.value.urlInput.trim()&&l.append("imageUrl",t.value.urlInput.trim()),t.value.updating=!0;try{const a=await fetch(`/api/categories/${s}`,{method:"PUT",body:l});if(!a.ok)throw new Error("Update failed");const i=await a.json(),I=u.value.findIndex(N=>N.id===s);I!==-1&&(i.imageUrl=i.imageUrl?`${i.imageUrl}?t=${Date.now()}`:null,u.value[I]=i),_()}catch(a){alert(a.message||"Error updating category")}finally{t.value.updating=!1}};return(s,l)=>(n(),o("div",M,[l[20]||(l[20]=e("div",{class:"d-flex justify-content-between align-items-center mb-4"},[e("h2",{class:"mb-0 text-primary"},"ðŸ“‚ Manage Categories")],-1)),e("div",P,[e("div",$,[e("form",{class:"row g-3 align-items-center",onSubmit:U(T,["prevent"])},[e("div",q,[l[6]||(l[6]=e("label",{class:"form-label fw-semibold"},"Category Name",-1)),c(e("input",{"onUpdate:modelValue":l[0]||(l[0]=a=>p.value=a),type:"text",class:"form-control",placeholder:"Enter new category",required:""},null,512),[[w,p.value]])]),e("div",B,[l[8]||(l[8]=e("label",{class:"form-label fw-semibold"},"Image Input Type",-1)),c(e("select",{"onUpdate:modelValue":l[1]||(l[1]=a=>m.value=a),class:"form-select"},l[7]||(l[7]=[e("option",{value:"file"},"Upload File",-1),e("option",{value:"url"},"Paste Image URL",-1)]),512),[[C,m.value]])]),e("div",O,[e("label",G,d(m.value==="file"?"Upload Image":"Image URL"),1),m.value==="file"?(n(),o("input",{key:0,ref_key:"fileInput",ref:h,type:"file",class:"form-control",accept:"image/*",onChange:E},null,544)):c((n(),o("input",{key:1,"onUpdate:modelValue":l[2]||(l[2]=a=>v.value=a),type:"url",class:"form-control",placeholder:"https://example.com/image.jpg"},null,512)),[[w,v.value]])]),e("div",z,[e("button",{class:"btn btn-success w-100",disabled:y.value},[l[9]||(l[9]=e("i",{class:"bi bi-plus-circle me-2"},null,-1)),b(" "+d(y.value?"...":"Add"),1)],8,H)])],32)])]),e("div",J,[e("div",K,[e("table",Q,[l[13]||(l[13]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"#"),e("th",null,"Name"),e("th",null,"ImageðŸ“·"),e("th",null,"Created"),e("th",null,"Actions")])],-1)),e("tbody",null,[(n(!0),o(V,null,j(u.value,a=>(n(),o("tr",{key:a.id},[e("td",null,d(a.id),1),e("td",W,d(a.name),1),e("td",null,[a.imageUrl?(n(),o("img",{key:0,src:a.imageUrl,class:"img-thumbnail",style:{"object-fit":"cover",width:"60px",height:"60px"},alt:"Image"},null,8,X)):f("",!0)]),e("td",null,d(x(a.createdAt)),1),e("td",null,[e("button",{class:"btn btn-outline-secondary btn-sm me-2",onClick:i=>A(a)},l[10]||(l[10]=[e("i",{class:"bi bi-pencil"},null,-1),b(" Edit ")]),8,Y),e("button",{class:"btn btn-outline-danger btn-sm",onClick:i=>D(a.id)},l[11]||(l[11]=[e("i",{class:"bi bi-trash"},null,-1),b(" Delete ")]),8,Z)])]))),128)),u.value.length?f("",!0):(n(),o("tr",ee,l[12]||(l[12]=[e("td",{colspan:"5",class:"text-center text-muted py-4"},[e("i",{class:"bi bi-inbox fs-3"}),e("br"),b(" No categories available ")],-1)])))])])])]),t.value.show?(n(),o("div",le)):f("",!0),t.value.show?(n(),o("div",te,[e("div",ae,[e("div",se,[e("div",oe,[e("h5",ne,[l[14]||(l[14]=e("i",{class:"bi bi-pencil-square me-2"},null,-1)),b("Edit Category #"+d(t.value.data.id),1)]),e("button",{type:"button",class:"btn-close btn-close-white",onClick:_})]),e("div",ie,[e("form",{onSubmit:U(L,["prevent"])},[e("div",re,[e("div",de,[l[15]||(l[15]=e("label",{class:"form-label"},"Name",-1)),c(e("input",{"onUpdate:modelValue":l[3]||(l[3]=a=>t.value.data.name=a),type:"text",class:"form-control",required:""},null,512),[[w,t.value.data.name]])]),e("div",ue,[l[17]||(l[17]=e("label",{class:"form-label"},"Image Input Type",-1)),c(e("select",{"onUpdate:modelValue":l[4]||(l[4]=a=>t.value.inputType=a),class:"form-select"},l[16]||(l[16]=[e("option",{value:"file"},"Upload File",-1),e("option",{value:"url"},"Paste Image URL",-1)]),512),[[C,t.value.inputType]])]),e("div",me,[e("label",ce,d(t.value.inputType==="file"?"Upload Image":"Image URL"),1),t.value.inputType==="file"?(n(),o("input",{key:0,type:"file",class:"form-control",onChange:F},null,32)):c((n(),o("input",{key:1,"onUpdate:modelValue":l[5]||(l[5]=a=>t.value.urlInput=a),type:"url",class:"form-control",placeholder:"https://example.com/image.jpg"},null,512)),[[w,t.value.urlInput]])]),t.value.data.imageUrl||t.value.preview?(n(),o("div",pe,[l[18]||(l[18]=e("label",{class:"form-label"},"Preview",-1)),l[19]||(l[19]=e("br",null,null,-1)),e("img",{src:t.value.preview||t.value.data.imageUrl,class:"img-thumbnail",style:{width:"80px",height:"80px","object-fit":"cover"}},null,8,ve)])):f("",!0),e("div",fe,[e("button",{class:"btn btn-secondary me-2",onClick:_},"Cancel"),e("button",{class:"btn btn-primary",disabled:t.value.updating},d(t.value.updating?"Updating...":"Update"),9,be)])])],32)])])])])):f("",!0)]))}},ye=S(ge,[["__scopeId","data-v-dafe6dc1"]]),we=window.__INITIAL_CATEGORIES__||[];R(ye,{initialCategories:we}).mount("#vue-categories-app");
